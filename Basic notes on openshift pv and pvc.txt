##### Create pv and pvc #####

[student@workstation ~] $ oc new-project install-storage
Now using project "install-storage" on server "https://api.ocp4.example.com:6443"

##  Create a new database deployment using the container image located at registry.redhat.io/rhel8/postgresql-13:1-7

[student@workstation ~]$ oc new-app --name postgresql-persistent --image registry.redhat.io/rhel8/postgresql-13:1-7 -e POSTGRESQL_USER=redhat -e POSTGRESQL_PASSWORD=redhat123 -e POSTGRESQL_DATABASE=persistentdb
...output omitted...
--> Creating resources ...
 imagestream.image.openshift.io "postgresql-persistent" created
 deployment.apps "postgresql-persistent" created
 service "postgresql-persistent" created
--> Success
...output omitted...

[student@workstation ~] $ oc get pods -n install-storage
postgresql-persistent-7c868bc77c-8rwgm
[student@workstation ~] $ oc exec -it postgresql-persistent-7c868bc77c-8rwgm -- df -h
/
/etc/passwd
..output omitted..


[student@workstation ~] $ oc get pv

[student@workstation ~] $ oc get pvc
No resources found in install-storage namespace

[student@workstation ~] $ oc set volumes deployment/postgresql-persistent --add --name postgresql-storage --type pvc --claim-class nfs-storage --claim-mode rwo --claim-size 10Gi --mount-path /var/lib/pgsql --claim-name postgresql-storage
deployment.apps/postgresql-persistent volume updated

[student@workstation ~] $ oc get pv
Name				Capacity 	Access Modes	Reclaim Policy	Status	Claim					Storageclass
pvc-6285930c-726f-4b9f-9969	10Gi		RWO		Delete		Bound	install-storage/postgresql-storage	nfs-storage

[student@workstation ~] $ oc get pvc
Name			Status	Volume				Capacity	Access Modes	Storageclass
postgresql-storage	Bound	pvc-6285930c-726f-4b9f-9969	10Gi		RWO		nfs-storage

[student@workstation ~] $ oc exec -it postgresql-persistent-5c5d87c974-ghq5t -- df -h
Filesystem								Mounted on
/dev/vda4								/etc/hosts
192.168.50.254:/exports-ocp4/install-storage-postgresql-storage		/var/lib/pgsql	


### Remove the postgresql-persistent deployment and create another deployment named postgresql-deployment2 that uses the same persistent volume; verify that the data persisted.
##  Delete all resources that contain the app=postgresql-persistent label.

[student@workstation ~] $ oc delete all -l app=postgresql-persistent
service "postgresql-persistent" deleted
deployment.apps "postgresql-persistent" deleted
imagestream.image.openshift.io "postgresql-persistent" deleted

### Create the postgresql-persistent2345 deployment with the same initialization data as the postgresql-persistent deployment.
[student@workstation ~]$ oc new-app --name postgresql-persistent2345 --image registry.redhat.io/rhel8/postgresql-13:1-7 -e POSTGRESQL_USER=redhat -e POSTGRESQL_PASSWORD=redhat123 -e POSTGRESQL_DATABASE=persistentdb
...output omitted...
--> Creating resources ...
 imagestream.image.openshift.io "postgresql-persistent2345" created
 deployment.apps "postgresql-persistent2345" created
 service "postgresql-persistent2345" created
--> Success
...output omitted...

## Add the existing postgresql-storage persistent volume claim to the postgresql-persistent2345 deployment.

[student@workstation ~]$ oc set volumes deployment/postgresql-persistent2345 --add --name postgresql-storage --type pvc --claim-name postgresql-storage --mount-path /var/lib/pgsql
deployment.apps/postgresql-persistent2 volume updated

## Remove the postgresql-persistent2 deployment and the persistent volume claim.
##  Delete all resources that contain the app=postgresql-persistent2 label.

[student@workstation ~]$ oc delete all -l app=postgresql-persistent2345
service "postgresql-persistent2345" deleted
deployment.apps "postgresql-persistent2345" deleted
imagestream.image.openshift.io "postgresql-persistent2345" deleted

## Delete the persistent volume by removing the postgresql-storage persistent volume claim, and then return to the home directory.

[student@workstation ~]$ oc delete pvc/postgresql-storage
persistentvolumeclaim "postgresql-storage" deleted










